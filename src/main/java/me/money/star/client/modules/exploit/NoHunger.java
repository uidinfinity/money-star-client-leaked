package me.money.star.client.modules.exploit;

import com.google.common.eventbus.Subscribe;
import me.money.star.client.gui.modules.Module;
import me.money.star.client.settings.Setting;
import me.money.star.event.impl.PacketEvent;
import me.money.star.mixin.accessor.AccessorPlayerMoveC2SPacket;
import net.minecraft.network.packet.c2s.play.ClientCommandC2SPacket;
import net.minecraft.network.packet.c2s.play.PlayerMoveC2SPacket;

public class NoHunger extends Module {
    public NoHunger() {
        super("NoHunger", "Prevents hunger loss",
                Category.EXPLOIT,true,false,false);
    }
    public Setting<Boolean> sprint = bool("Sprint", true);
    public Setting<Boolean> ground = bool("Ground", true);
    @Subscribe
    public void onPacketOutbound(PacketEvent.Outbound event)
    {
        if (mc.player != null && mc.world != null && !mc.player.isGliding() && !mc.player.isRiding())
        {
            if (event.getPacket() instanceof PlayerMoveC2SPacket packet
                    && ground.getValue() && !packet.isOnGround()
                    && mc.player.fallDistance <= 3.0f)
            {
                ((AccessorPlayerMoveC2SPacket) packet).hookSetOnGround(!mc.player.isRiding());
            }
            else if (event.getPacket() instanceof ClientCommandC2SPacket packet
                    && sprint.getValue() && (packet.getMode() == ClientCommandC2SPacket.Mode.START_SPRINTING
                    || packet.getMode() == ClientCommandC2SPacket.Mode.STOP_SPRINTING))
            {
                event.cancel();
            }
        }
    }
}
